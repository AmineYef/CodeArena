<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rejoindre Contest {{ contest_id }} - CodeArena</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .badge-easy {
            background: #d4edda;
            color: #155724;
        }
        .badge-medium {
            background: #fff3cd;
            color: #856404;
        }
        .badge-hard {
            background: #f8d7da;
            color: #721c24;
        }
        .problem-card {
            border: 2px solid #e0e0e0;
            padding: 1.5rem;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .problem-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">ğŸ† CodeArena</h1>
            <ul class="nav-links">
                <li><a href="/">Accueil</a></li>
                <li><a href="/contests">Contests</a></li>
                <li><a href="/creator">CrÃ©er Contest</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="join-container" style="max-width: 900px; margin: 2rem auto;">
            
            <!-- Contest Header -->
            <div class="contest-header-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                <h1 style="margin: 0 0 0.5rem 0; font-size: 2rem;">Contest {{ contest_id }}</h1>
                <div style="display: flex; gap: 2rem; align-items: center; flex-wrap: wrap;">
                    <div>
                        <span style="opacity: 0.9; font-size: 0.9rem;">â±ï¸ Temps restant:</span>
                        <div id="timer" style="font-size: 2rem; font-weight: bold; margin-top: 0.25rem;">
                            Chargement...
                        </div>
                    </div>
                    <div>
                        <span style="opacity: 0.9; font-size: 0.9rem;">ğŸ“Š DifficultÃ©:</span>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-top: 0.25rem;">
                            {{ contest.difficulty.upper() }}
                        </div>
                    </div>
                    <div>
                        <span style="opacity: 0.9; font-size: 0.9rem;">ğŸ“ ProblÃ¨mes:</span>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-top: 0.25rem;">
                            {{ contest.num_problems }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Registration Form -->
            <div class="registration-card" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <h2 style="margin-top: 0; color: #333;">ğŸ‘¤ Entrez votre nom d'utilisateur</h2>
                <form method="POST" action="/contest/{{ contest_id }}/join" id="joinForm" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <label for="username" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #555;">Nom d'utilisateur</label>
                        <input 
                            type="text" 
                            id="username" 
                            name="username" 
                            required 
                            minlength="3"
                            maxlength="20"
                            placeholder="Ex: Ali_2024"
                            style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;"
                        >
                        <small style="color: #777; display: block; margin-top: 0.25rem;">Entre 3 et 20 caractÃ¨res</small>
                    </div>
                    <button type="submit" class="btn btn-primary" style="padding: 0.75rem 2rem; font-size: 1.1rem; white-space: nowrap;">
                        ğŸš€ Rejoindre le Contest
                    </button>
                </form>
            </div>

            <!-- Problems List -->
            <div class="problems-card" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <h2 style="margin-top: 0; color: #333;">ğŸ“‹ ProblÃ¨mes du Contest</h2>
                <div style="display: grid; gap: 1rem;">
                    {% for problem_id in contest.problems %}
                    <div class="problem-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: #667eea; font-size: 1.3rem;">{{ problem_id }}</h3>
                                <p style="margin: 0; color: #666;">Cliquez sur "Rejoindre" pour voir l'Ã©noncÃ© complet</p>
                            </div>
                            <span class="badge badge-{{ contest.difficulty }}">
                                {{ contest.difficulty }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Contest Rules -->
            <div class="rules-card" style="background: #f8f9fa; padding: 2rem; border-radius: 12px; border-left: 4px solid #667eea;">
                <h3 style="margin-top: 0; color: #333;">ğŸ“– RÃ¨gles du Contest</h3>
                <ul style="color: #555; line-height: 1.8; margin: 0;">
                    <li><strong>âœ… Correct (OK):</strong> +100 points</li>
                    <li><strong>âŒ Mauvaise rÃ©ponse:</strong> -10 points</li>
                    <li><strong>â±ï¸ Temps dÃ©passÃ© (Timeout):</strong> -20 points</li>
                    <li><strong>ğŸ› ï¸ Erreur de compilation:</strong> -5 points</li>
                    <li><strong>ğŸ’¥ Erreur d'exÃ©cution:</strong> -10 points</li>
                    <li><strong>ğŸ† Le gagnant</strong> est celui qui a le plus de points Ã  la fin du temps</li>
                    <li><strong>ğŸ”’ Les soumissions</strong> ne seront plus acceptÃ©es aprÃ¨s la fin du timer</li>
                </ul>
            </div>

            <!-- Bottom Actions -->
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
                <a href="/contests" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">
                    â† Retour aux Contests
                </a>
                <a href="/contest/{{ contest_id }}/leaderboard" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">
                    ğŸ“Š Voir le Classement
                </a>
            </div>

        </div>
    </div>

    <footer style="margin-top: 4rem; padding: 2rem 0; background: #f8f9fa; text-align: center; color: #666;">
        <div class="container">
            <p style="margin: 0;">CodeArena - Plateforme de Contest en Temps RÃ©el</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Bonne chance ! ğŸš€</p>
        </div>
    </footer>

    <script>
        // Timer dynamique - corrigÃ©
      let remainingTime = parseInt('{{ contest.remaining_time }}');
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateTimer() {
            const timerElement = document.getElementById('timer');
            
            if (remainingTime <= 0) {
                timerElement.innerHTML = '<span style="color: #ff4444;">TerminÃ© â°</span>';
                return;
            }
            
            timerElement.textContent = formatTime(remainingTime);
            
            // Changer la couleur si moins de 5 minutes
            if (remainingTime <= 300) {
                timerElement.style.color = '#ffc107';
            }
            
            // Changer la couleur si moins d'1 minute
            if (remainingTime <= 60) {
                timerElement.style.color = '#ff4444';
            }
            
            remainingTime--;
        }
        
        // Initialiser le timer
        updateTimer();
        
        // Mise Ã  jour toutes les secondes
        setInterval(updateTimer, 1000);
        
        // Validation du formulaire
        document.getElementById('joinForm').addEventListener('submit', function(e) {
            const username = document.getElementById('username').value.trim();
            
            // VÃ©rifier la longueur
            if (username.length < 3) {
                e.preventDefault();
                alert('âš ï¸ Le nom d\'utilisateur doit contenir au moins 3 caractÃ¨res');
                return;
            }
            
            if (username.length > 20) {
                e.preventDefault();
                alert('âš ï¸ Le nom d\'utilisateur ne peut pas dÃ©passer 20 caractÃ¨res');
                return;
            }
            
            // VÃ©rifier que le contest n'est pas terminÃ©
            if (remainingTime <= 0) {
                e.preventDefault();
                alert('â° Le contest est terminÃ© ! Les inscriptions sont fermÃ©es.');
                return;
            }
            
            // VÃ©rifier les caractÃ¨res valides (lettres, chiffres, underscore)
            const validUsername = /^[a-zA-Z0-9_]+$/;
            if (!validUsername.test(username)) {
                e.preventDefault();
                alert('âš ï¸ Le nom d\'utilisateur ne peut contenir que des lettres, chiffres et underscore (_)');
                return;
            }
        });
        
        // Focus automatique sur le champ username
        document.getElementById('username').focus();
    </script>

</body>
</html>