<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Contest {{ contest_id }} - CodeArena</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .header-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .problem-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        .problem-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }
        .problem-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 1rem;
        }
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .badge-easy { background: #d4edda; color: #155724; }
        .badge-medium { background: #fff3cd; color: #856404; }
        .badge-hard { background: #f8d7da; color: #721c24; }
        .badge-solved { background: #4CAF50; color: white; }
        .badge-unsolved { background: #f8f9fa; color: #666; }
        .timer {
            font-family: 'Courier New', monospace;
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">üèÜ CodeArena</h1>
            <div style="display: flex; align-items: center; gap: 2rem;">
                <div style="color: #667eea; font-weight: bold;">
                    üë§ {{ username }}
                </div>
                <ul class="nav-links">
                    <li><a href="/">Accueil</a></li>
                    <li><a href="/contest/{{ contest_id }}/leaderboard">Classement</a></li>
                    <li><a href="/contests">Autres Contests</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header-card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <h1 style="margin: 0 0 0.5rem 0; font-size: 2rem;">Contest {{ contest_id }}</h1>
                    <p style="opacity: 0.9; margin: 0;">Bienvenue, <strong>{{ username }}</strong> !</p>
                </div>
                <div style="text-align: center;">
                    <div style="opacity: 0.9; font-size: 0.9rem;">‚è±Ô∏è TEMPS RESTANT</div>
                    <div id="timer" class="timer">Chargement...</div>
                    <div style="opacity: 0.8; font-size: 0.9rem;">Difficult√© : {{ contest.difficulty.upper() }}</div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
            <!-- Colonne gauche : Probl√®mes -->
            <div>
                <h2 style="color: #333; margin-bottom: 1.5rem;">üìù Probl√®mes</h2>
                
                {% for problem in problems_numbered %}
                <div class="problem-card">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div class="problem-number">{{ problem.number }}</div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 0.5rem 0; color: #667eea; font-size: 1.3rem;">
                                Probl√®me {{ problem.number }}
                            </h3>
                            <p style="margin: 0; color: #666; font-size: 0.95rem;">
                                Cliquez pour voir l'√©nonc√© et soumettre votre solution
                            </p>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span class="badge badge-{{ contest.difficulty }}">
                                {{ contest.difficulty }}
                            </span>
                            <span class="badge badge-unsolved">
                                Non r√©solu
                            </span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <a href="/contest/{{ contest_id }}/problem/{{ problem.number }}?username={{ username }}" 
                           class="btn btn-primary" style="padding: 0.5rem 1.5rem;">
                            üëÅÔ∏è Voir l'√ânonc√©
                        </a>
                        <a href="/contest/{{ contest_id }}/problem/{{ problem.number }}?username={{ username }}" 
                           class="btn btn-secondary" style="padding: 0.5rem 1.5rem;">
                            üíª Soumettre Solution
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Colonne droite : Stats et Actions -->
            <div>
                <!-- Statistiques -->
                <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 1.5rem;">
                    <h3 style="margin-top: 0; color: #333; margin-bottom: 1rem;">üìä Vos Statistiques</h3>
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                            <span>Probl√®mes r√©solus :</span>
                            <strong id="user-solved">0/{{ contest.num_problems }}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                            <span>Soumissions :</span>
                            <strong id="user-submissions">0</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                            <span>Score actuel :</span>
                            <strong id="user-score">0 points</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                            <span>Position :</span>
                            <strong id="user-position">--</strong>
                        </div>
                    </div>
                </div>

                <!-- Actions rapides -->
                <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 1.5rem;">
                    <h3 style="margin-top: 0; color: #333; margin-bottom: 1rem;">‚ö° Actions Rapides</h3>
                    <div style="display: grid; gap: 0.75rem;">
                        <a href="/contest/{{ contest_id }}/leaderboard" class="btn btn-primary" style="text-align: center;">
                            üìä Voir Classement Complet
                        </a>
                        <button onclick="refreshStats()" class="btn btn-secondary" style="text-align: center;">
                            üîÑ Rafra√Æchir Statistiques
                        </button>
                    </div>
                </div>

                <!-- R√®gles -->
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #667eea;">
                    <h4 style="margin-top: 0; color: #333;">üìñ R√®gles</h4>
                    <ul style="margin: 0.5rem 0 0 0; padding-left: 1.2rem; color: #555; font-size: 0.9rem;">
                        <li>‚úÖ OK: +100 points</li>
                        <li>‚ùå Mauvaise r√©ponse: -10 points</li>
                        <li>‚è±Ô∏è Timeout: -20 points</li>
                        <li>üí• Erreur: -10 points</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer style="margin-top: 4rem; padding: 2rem 0; background: #f8f9fa; text-align: center; color: #666;">
        <div class="container">
            <p style="margin: 0;">CodeArena - Plateforme de Contest en Temps R√©el</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Bonne chance dans le contest ! üöÄ</p>
        </div>
    </footer>

    <script>
        // Timer dynamique
        let remainingTime = parseInt('{{ contest.remaining_time }}');
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateTimer() {
            const timerElement = document.getElementById('timer');
            
            if (remainingTime <= 0) {
                timerElement.innerHTML = '<span style="color: #ff4444;">TERMIN√â ‚è∞</span>';
                document.querySelectorAll('.btn-primary, .btn-secondary').forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.style.pointerEvents = 'none';
                });
                return;
            }
            
            timerElement.textContent = formatTime(remainingTime);
            
            if (remainingTime <= 300) {
                timerElement.style.color = '#ffc107';
            }
            
            if (remainingTime <= 60) {
                timerElement.style.color = '#ff4444';
            }
            
            remainingTime--;
        }
        
        // Initialiser le timer
        updateTimer();
        setInterval(updateTimer, 1000);
        
        // Rafra√Æchir les statistiques
        function refreshStats() {
            fetch(`/api/contest/{{ contest_id }}/leaderboard`)
                .then(response => response.json())
                .then(data => {
                    const userEntry = data.find(entry => entry.user === '{{ username }}');
                    
                    if (userEntry) {
                        document.getElementById('user-score').textContent = userEntry.score + ' points';
                        document.getElementById('user-solved').textContent = userEntry.solved + '/{{ contest.num_problems }}';
                        
                        const position = data.findIndex(entry => entry.user === '{{ username }}') + 1;
                        document.getElementById('user-position').textContent = position;
                    }
                })
                .catch(error => console.error('Erreur:', error));
        }
        
        // Rafra√Æchir automatiquement toutes les 10 secondes
        setInterval(refreshStats, 10000);
        refreshStats();
    </script>
</body>
</html>