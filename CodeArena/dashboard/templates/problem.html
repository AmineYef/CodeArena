<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ meta.title }} - CodeArena</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">üèÜ CodeArena</h1>
            <ul class="nav-links">
                <li><a href="/contest/{{ contest_id }}/dashboard?username={{ username }}">Retour au Contest</a></li>
                <li><a href="/contest/{{ contest_id }}/leaderboard">Leaderboard</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="problem-layout">
            <!-- Colonne gauche : √ânonc√© -->
            <div class="problem-statement">
                <div class="problem-header">
                    <h1>{{ meta.title }}</h1>
                    <span class="badge badge-{{ meta.difficulty }}">{{ meta.difficulty }}</span>
                </div>

                <div class="problem-content">
                    {{ statement | safe }}
                </div>
            </div>

            <!-- Colonne droite : √âditeur de code -->
            <div class="code-editor-panel">
                <div class="editor-header">
                    <label for="language">Langage :</label>
                    <select id="language" name="language">
                        <option value="python">Python</option>
                        <option value="cpp">C++</option>
                        <option value="java">Java</option>
                    </select>
                </div>

                <textarea id="code-editor" class="code-editor" placeholder="// √âcrivez votre code ici..."></textarea>

                <div class="editor-actions">
                    <button id="submit-btn" class="btn btn-primary">Soumettre</button>
                    <button id="clear-btn" class="btn btn-secondary">Effacer</button>
                </div>

                <div id="result" class="result-box" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        const submitBtn = document.getElementById('submit-btn');
        const clearBtn = document.getElementById('clear-btn');
        const codeEditor = document.getElementById('code-editor');
        const languageSelect = document.getElementById('language');
        const resultBox = document.getElementById('result');

        submitBtn.addEventListener('click', async () => {
            const code = codeEditor.value.trim();
            if (!code) {
                alert('Veuillez √©crire du code avant de soumettre.');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Envoi en cours...';

            try {
                const response = await fetch('/api/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: '{{ username }}',
                        problem_id: '{{ problem_id }}',
                        language: languageSelect.value,
                        code: code
                    })
                });

                const data = await response.json();
                
                resultBox.style.display = 'block';
                if (data.success) {
                    resultBox.className = 'result-box success';
                    resultBox.innerHTML = `
                        <h3>‚úÖ Soumission re√ßue</h3>
                        <p>ID: ${data.submission_id}</p>
                        <p>Votre code est en cours d'√©valuation...</p>
                    `;
                } else {
                    resultBox.className = 'result-box error';
                    resultBox.innerHTML = `<h3>‚ùå Erreur</h3><p>${data.error}</p>`;
                }
            } catch (error) {
                resultBox.style.display = 'block';
                resultBox.className = 'result-box error';
                resultBox.innerHTML = `<h3>‚ùå Erreur</h3><p>${error.message}</p>`;
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Soumettre';
        });

        clearBtn.addEventListener('click', () => {
            if (confirm('Effacer tout le code ?')) {
                codeEditor.value = '';
                resultBox.style.display = 'none';
            }
        });
    </script>
</body>
</html>